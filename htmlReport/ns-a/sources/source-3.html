


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > MainActivity</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.frhanklin.disastory.presentation.ui.activities</a>
</div>

<h1>Coverage Summary for Class: MainActivity (com.frhanklin.disastory.presentation.ui.activities)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">MainActivity</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/27)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/156)
  </span>
</td>
</tr>
  <tr>
    <td class="name">MainActivity$sam$androidx_lifecycle_Observer$0</td>
  </tr>
  <tr>
    <td class="name">MainActivity$setObservable$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MainActivity$setObservable$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MainActivity$setObservable$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MainActivity$setObservable$5</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MainActivity$setObservable$6</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MainActivity$setObservable$7</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MainActivity$setObservable$8</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MainActivity$setViews$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MainActivity$setViews$10</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MainActivity$setViews$13</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MainActivity$setViews$13$gestureDetector$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MainActivity$viewModel$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MainActivity$WhenMappings</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/48)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/205)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.frhanklin.disastory.presentation.ui.activities
&nbsp;
&nbsp;import android.annotation.SuppressLint
&nbsp;import android.content.Intent
&nbsp;import androidx.appcompat.app.AppCompatActivity
&nbsp;import android.os.Bundle
&nbsp;import android.os.Handler
&nbsp;import android.os.Looper
&nbsp;import android.view.GestureDetector
&nbsp;import android.view.MotionEvent
&nbsp;import android.view.View
&nbsp;import android.widget.ArrayAdapter
&nbsp;import android.widget.LinearLayout
&nbsp;import androidx.appcompat.app.AppCompatDelegate
&nbsp;import androidx.appcompat.widget.SearchView
&nbsp;import androidx.lifecycle.Observer
&nbsp;import androidx.lifecycle.ViewModelProvider
&nbsp;import androidx.paging.PagedList
&nbsp;import androidx.recyclerview.widget.LinearLayoutManager
&nbsp;import androidx.recyclerview.widget.RecyclerView
&nbsp;import androidx.vectordrawable.graphics.drawable.VectorDrawableCompat
&nbsp;import androidx.work.PeriodicWorkRequest
&nbsp;import androidx.work.WorkManager
&nbsp;import com.frhanklin.disastory.presentation.ui.viewmodel.MainViewModel
&nbsp;import com.frhanklin.disastory.R
&nbsp;import com.frhanklin.disastory.data.local.entity.DisasterModel
&nbsp;import com.frhanklin.disastory.data.remote.response.DisasterItems
&nbsp;import com.frhanklin.disastory.databinding.ActivityMainBinding
&nbsp;import com.frhanklin.disastory.databinding.BottomDisasterListBinding
&nbsp;import com.frhanklin.disastory.presentation.ui.adapters.DisasterAdapter
&nbsp;import com.frhanklin.disastory.utils.BitmapUtils
&nbsp;import com.frhanklin.disastory.utils.DisasterUtils
&nbsp;import com.frhanklin.disastory.utils.NotificationWorker
&nbsp;import com.frhanklin.disastory.utils.Resource
&nbsp;import com.frhanklin.disastory.utils.Status
&nbsp;import com.google.android.gms.maps.CameraUpdateFactory
&nbsp;import com.google.android.gms.maps.SupportMapFragment
&nbsp;import com.google.android.gms.maps.model.BitmapDescriptorFactory
&nbsp;import com.google.android.gms.maps.model.LatLng
&nbsp;import com.google.android.gms.maps.model.MapStyleOptions
&nbsp;import com.google.android.gms.maps.model.MarkerOptions
&nbsp;import com.google.android.material.bottomsheet.BottomSheetBehavior
&nbsp;import com.google.android.material.bottomsheet.BottomSheetBehavior.BottomSheetCallback
&nbsp;import com.google.android.material.bottomsheet.BottomSheetBehavior.from
&nbsp;import dagger.hilt.android.AndroidEntryPoint
&nbsp;import java.util.concurrent.TimeUnit
&nbsp;import javax.inject.Inject
&nbsp;
&nbsp;@AndroidEntryPoint
<b class="nc">&nbsp;class MainActivity : AppCompatActivity(), DisasterAdapter.OnItemClickCallback {</b>
&nbsp;
&nbsp;    private lateinit var mapFragment: SupportMapFragment
&nbsp;
&nbsp;    private lateinit var mainBinding: ActivityMainBinding
&nbsp;    private lateinit var bottomSheetBinding: BottomDisasterListBinding
&nbsp;    private lateinit var bottomSheetBehavior: BottomSheetBehavior&lt;LinearLayout&gt;
&nbsp;
<b class="nc">&nbsp;    private val viewModel: MainViewModel by lazy {</b>
<b class="nc">&nbsp;        ViewModelProvider(this).get(MainViewModel::class.java)</b>
&nbsp;    }
&nbsp;    private lateinit var disasterAdapter: DisasterAdapter
&nbsp;
&nbsp;    private lateinit var workManager: WorkManager
&nbsp;
&nbsp;    @Inject
<b class="nc">&nbsp;    internal lateinit var disasterUtils: DisasterUtils</b>
&nbsp;    private lateinit var disasterObserver: Observer&lt;Resource&lt;PagedList&lt;DisasterModel&gt;&gt;&gt;
&nbsp;
&nbsp;    override fun onCreate(savedInstanceState: Bundle?) {
<b class="nc">&nbsp;        super.onCreate(savedInstanceState)</b>
&nbsp;
<b class="nc">&nbsp;        mainBinding = ActivityMainBinding.inflate(layoutInflater)</b>
<b class="nc">&nbsp;        setContentView(mainBinding.root)</b>
&nbsp;
<b class="nc">&nbsp;        bottomSheetBinding = mainBinding.bottomSheet</b>
<b class="nc">&nbsp;        bottomSheetBehavior = from(bottomSheetBinding.bottomSheetLayout)</b>
&nbsp;
<b class="nc">&nbsp;        initiateObjects()</b>
<b class="nc">&nbsp;        setObservable()</b>
<b class="nc">&nbsp;        setViews()</b>
&nbsp;    }
&nbsp;
&nbsp;    private fun setObservable() {
<b class="nc">&nbsp;        viewModel.getThemeSettings().observe(this) { nightState -&gt;</b>
<b class="nc">&nbsp;            if (nightState) {</b>
<b class="nc">&nbsp;                AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_YES)</b>
<b class="nc">&nbsp;                mapFragment.getMapAsync {</b>
<b class="nc">&nbsp;                    val darkStyle = MapStyleOptions.loadRawResourceStyle(this, R.raw.dark_mode_map_styles)</b>
<b class="nc">&nbsp;                    it.setMapStyle(darkStyle)</b>
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_NO)</b>
&nbsp;
&nbsp;            }
<b class="nc">&nbsp;            viewModel.saveThemeSettings(nightState)</b>
&nbsp;        }
<b class="nc">&nbsp;        viewModel.getNotificationSettings().observe(this) { notificationIsEnabled -&gt;</b>
<b class="nc">&nbsp;            println(&quot;Notif state: &quot;+notificationIsEnabled)</b>
<b class="nc">&nbsp;            if (notificationIsEnabled) {</b>
<b class="nc">&nbsp;                workManager = WorkManager.getInstance(this)</b>
<b class="nc">&nbsp;                setUpPeriodicNotification()</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        disasterObserver = Observer&lt;Resource&lt;PagedList&lt;DisasterModel&gt;&gt;&gt; {</b>
<b class="nc">&nbsp;            if (it != null) {</b>
<b class="nc">&nbsp;                when (it.status) {</b>
&nbsp;                    Status.LOADING -&gt; {
<b class="nc">&nbsp;                        showLoading(true)</b>
&nbsp;                    }
&nbsp;                    Status.SUCCESS -&gt; {
<b class="nc">&nbsp;                        showLoading(false)</b>
<b class="nc">&nbsp;                        disasterAdapter.submitList(it.data)</b>
<b class="nc">&nbsp;                        disasterAdapter.setOnItemClickCallback(this)</b>
<b class="nc">&nbsp;                        disasterAdapter.notifyDataSetChanged()</b>
<b class="nc">&nbsp;                        if (it.data.isNullOrEmpty()) {</b>
<b class="nc">&nbsp;                            viewModel.setWarn(true, applicationContext.getString(R.string.warning_no_data))</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            viewModel.setWarn(false, &quot;&quot;)</b>
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        bottomSheetBinding.rvDisasterList.adapter = disasterAdapter</b>
&nbsp;                    }
&nbsp;                    Status.ERROR -&gt; {
<b class="nc">&nbsp;                        showLoading(false)</b>
<b class="nc">&nbsp;                        viewModel.setWarn(true, applicationContext.getString(R.string.warning_exception))</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        viewModel.getDisaster().observe(this, disasterObserver)</b>
&nbsp;
<b class="nc">&nbsp;        viewModel.filter.observe(this) {</b>
<b class="nc">&nbsp;            viewModel.getDisaster().observe(this, disasterObserver)</b>
&nbsp;        }
<b class="nc">&nbsp;        viewModel.filterArray.observe(this) {</b>
<b class="nc">&nbsp;            updateDisasterFilterButtons(it)</b>
&nbsp;        }
<b class="nc">&nbsp;        viewModel.cityId.observe(this) {</b>
<b class="nc">&nbsp;            viewModel.getDisaster().observe(this, disasterObserver)</b>
&nbsp;        }
<b class="nc">&nbsp;        viewModel.isWarned.observe(this) {isWarned -&gt;</b>
<b class="nc">&nbsp;            bottomSheetBinding.warningLayout.visibility = if (isWarned) {</b>
<b class="nc">&nbsp;                View.VISIBLE</b>
&nbsp;            } else {
<b class="nc">&nbsp;                View.GONE</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        viewModel.warningText.observe(this) { newWarning -&gt;</b>
<b class="nc">&nbsp;            bottomSheetBinding.tvWarning.text = newWarning</b>
<b class="nc">&nbsp;            bottomSheetBinding.imgWarning.setImageDrawable(disasterUtils.getWarningImage(newWarning))</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun updateDisasterFilterButtons(it: ArrayList&lt;String&gt;) {
<b class="nc">&nbsp;        for (item in it) {</b>
<b class="nc">&nbsp;            val view = when (item)  {</b>
<b class="nc">&nbsp;                &quot;flood&quot; -&gt; mainBinding.btnSearchFlood</b>
<b class="nc">&nbsp;                &quot;haze&quot; -&gt; mainBinding.btnSearchHaze</b>
<b class="nc">&nbsp;                &quot;wind&quot; -&gt; mainBinding.btnSearchWind</b>
<b class="nc">&nbsp;                &quot;earthquake&quot; -&gt; mainBinding.btnSearchEarthquake</b>
<b class="nc">&nbsp;                &quot;volcano&quot; -&gt; mainBinding.btnSearchVolcano</b>
<b class="nc">&nbsp;                &quot;fire&quot; -&gt; mainBinding.btnSearchFire</b>
<b class="nc">&nbsp;                else -&gt; mainBinding.btnSearchFlood</b>
&nbsp;            }
<b class="nc">&nbsp;            view.isSelected = true</b>
<b class="nc">&nbsp;            view.background = getDrawable(R.drawable.round_fill_green)</b>
&nbsp;//            if (!isAlreadySelected) {
&nbsp;//                view.isSelected = true
&nbsp;//
&nbsp;//            } else {
&nbsp;//                view.isSelected = false
&nbsp;//                view.background = getDrawable(R.drawable.round_fill)
&nbsp;//            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun showLoading(isLoading: Boolean) {
<b class="nc">&nbsp;        if (isLoading) {</b>
<b class="nc">&nbsp;            mainBinding.loading.visibility = View.VISIBLE</b>
<b class="nc">&nbsp;            bottomSheetBehavior.state = BottomSheetBehavior.STATE_COLLAPSED</b>
&nbsp;        } else {
<b class="nc">&nbsp;            Handler(Looper.getMainLooper()).postDelayed({</b>
<b class="nc">&nbsp;                mainBinding.loading.visibility = View.GONE</b>
<b class="nc">&nbsp;                bottomSheetBehavior.state = BottomSheetBehavior.STATE_HALF_EXPANDED</b>
<b class="nc">&nbsp;            }, 1000)</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun initiateObjects() {
<b class="nc">&nbsp;        bottomSheetBinding.rvDisasterList.layoutManager = LinearLayoutManager(this)</b>
<b class="nc">&nbsp;        mapFragment = supportFragmentManager.findFragmentById(R.id.maps) as SupportMapFragment</b>
<b class="nc">&nbsp;        disasterAdapter = DisasterAdapter(disasterUtils)</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private fun setUpPeriodicNotification() {
&nbsp;
<b class="nc">&nbsp;        val periodicNotificationRequest = PeriodicWorkRequest.Builder(</b>
&nbsp;            NotificationWorker::class.java,
<b class="nc">&nbsp;            repeatInterval = 15,</b>
<b class="nc">&nbsp;            repeatIntervalTimeUnit = TimeUnit.MINUTES</b>
<b class="nc">&nbsp;        ).build()</b>
&nbsp;
<b class="nc">&nbsp;        workManager.enqueue(periodicNotificationRequest)</b>
&nbsp;    }
&nbsp;
&nbsp;    @SuppressLint(&quot;SetTextI18n&quot;)
&nbsp;    private fun setViews() {
&nbsp;
<b class="nc">&nbsp;        bottomSheetBehavior.addBottomSheetCallback(object: BottomSheetCallback() {</b>
&nbsp;            override fun onStateChanged(bottomSheet: View, newState: Int) {
<b class="nc">&nbsp;                bottomSheetBinding.btnBack.visibility = when (newState) {</b>
&nbsp;                    BottomSheetBehavior.STATE_EXPANDED -&gt; {
<b class="nc">&nbsp;                        View.VISIBLE</b>
&nbsp;                    }
&nbsp;                    BottomSheetBehavior.STATE_COLLAPSED -&gt; {
<b class="nc">&nbsp;                        View.INVISIBLE</b>
&nbsp;                    }
&nbsp;                    else -&gt; {
<b class="nc">&nbsp;                        View.INVISIBLE</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
&nbsp;            override fun onSlide(bottomSheet: View, slideOffset: Float) {
&nbsp;
<b class="nc">&nbsp;            }</b>
&nbsp;
&nbsp;        })
<b class="nc">&nbsp;        bottomSheetBinding.btnBack.setOnClickListener {</b>
<b class="nc">&nbsp;            bottomSheetBehavior.state = BottomSheetBehavior.STATE_COLLAPSED</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        mainBinding.btnSearchFlood.text = &quot;+ &quot; + getString(R.string.type_flood)</b>
<b class="nc">&nbsp;        mainBinding.btnSearchHaze.text = &quot;+ &quot; + getString(R.string.type_haze)</b>
<b class="nc">&nbsp;        mainBinding.btnSearchWind.text = &quot;+ &quot; + getString(R.string.type_wind)</b>
<b class="nc">&nbsp;        mainBinding.btnSearchEarthquake.text = &quot;+ &quot; + getString(R.string.type_earthquake)</b>
<b class="nc">&nbsp;        mainBinding.btnSearchVolcano.text = &quot;+ &quot; + getString(R.string.type_volcano)</b>
<b class="nc">&nbsp;        mainBinding.btnSearchFire.text = &quot;+ &quot; + getString(R.string.type_fire)</b>
&nbsp;
<b class="nc">&nbsp;        mainBinding.btnSettings.setOnClickListener {</b>
<b class="nc">&nbsp;            val intent = Intent(this, SettingsActivity::class.java)</b>
<b class="nc">&nbsp;            startActivity(intent)</b>
&nbsp;        }
<b class="nc">&nbsp;        mainBinding.btnSearchFlood.setOnClickListener{</b>
<b class="nc">&nbsp;            val filterOn = onCustomRadioButtonClick(it)</b>
<b class="nc">&nbsp;            if (filterOn) {</b>
<b class="nc">&nbsp;                viewModel.addFilter(&quot;flood&quot;)</b>
&nbsp;            } else {
<b class="nc">&nbsp;                viewModel.removeFilter(&quot;flood&quot;)</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        mainBinding.btnSearchHaze.setOnClickListener{</b>
<b class="nc">&nbsp;            val filterOn = onCustomRadioButtonClick(it)</b>
<b class="nc">&nbsp;            if (filterOn) {</b>
<b class="nc">&nbsp;                viewModel.addFilter(&quot;haze&quot;)</b>
&nbsp;            } else {
<b class="nc">&nbsp;                viewModel.removeFilter(&quot;haze&quot;)</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        mainBinding.btnSearchWind.setOnClickListener{</b>
<b class="nc">&nbsp;            val filterOn = onCustomRadioButtonClick(it)</b>
<b class="nc">&nbsp;            if (filterOn) {</b>
<b class="nc">&nbsp;                viewModel.addFilter(&quot;wind&quot;)</b>
&nbsp;            } else {
<b class="nc">&nbsp;                viewModel.removeFilter(&quot;wind&quot;)</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        mainBinding.btnSearchEarthquake.setOnClickListener{</b>
<b class="nc">&nbsp;            val filterOn = onCustomRadioButtonClick(it)</b>
<b class="nc">&nbsp;            if (filterOn) {</b>
<b class="nc">&nbsp;                viewModel.addFilter(&quot;earthquake&quot;)</b>
&nbsp;            } else {
<b class="nc">&nbsp;                viewModel.removeFilter(&quot;earthquake&quot;)</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        mainBinding.btnSearchVolcano.setOnClickListener{</b>
<b class="nc">&nbsp;            val filterOn = onCustomRadioButtonClick(it)</b>
<b class="nc">&nbsp;            if (filterOn) {</b>
<b class="nc">&nbsp;                viewModel.addFilter(&quot;volcano&quot;)</b>
&nbsp;            } else {
<b class="nc">&nbsp;                viewModel.removeFilter(&quot;volcano&quot;)</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        mainBinding.btnSearchFire.setOnClickListener{</b>
<b class="nc">&nbsp;            val filterOn = onCustomRadioButtonClick(it)</b>
<b class="nc">&nbsp;            if (filterOn) {</b>
<b class="nc">&nbsp;                viewModel.addFilter(&quot;fire&quot;)</b>
&nbsp;            } else {
<b class="nc">&nbsp;                viewModel.removeFilter(&quot;fire&quot;)</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        val cityNamesArray = resources.getStringArray(R.array.city_names)</b>
<b class="nc">&nbsp;        val searchAdapter = ArrayAdapter(this, R.layout.item_row_city, cityNamesArray)</b>
<b class="nc">&nbsp;        mainBinding.listSearchSuggestion.adapter = searchAdapter</b>
<b class="nc">&nbsp;        mainBinding.searchMain.setOnQueryTextListener(object: SearchView.OnQueryTextListener {</b>
&nbsp;            override fun onQueryTextSubmit(query: String?): Boolean {
&nbsp;                // Handle the search submission
<b class="nc">&nbsp;                viewModel.setLocation(query ?: &quot;&quot;)</b>
<b class="nc">&nbsp;                mainBinding.searchMain.clearFocus()</b>
<b class="nc">&nbsp;                viewModel.getDisaster().observe(this@MainActivity, disasterObserver)</b>
<b class="nc">&nbsp;                return true</b>
&nbsp;            }
&nbsp;
&nbsp;            override fun onQueryTextChange(newText: String?): Boolean {
<b class="nc">&nbsp;                if (newText.isNullOrBlank()) {</b>
<b class="nc">&nbsp;                    viewModel.setLocation(&quot;&quot;)</b>
<b class="nc">&nbsp;                    viewModel.getDisaster().observe(this@MainActivity, disasterObserver)</b>
&nbsp;                }
<b class="nc">&nbsp;                searchAdapter.filter.filter(newText)</b>
<b class="nc">&nbsp;                return true</b>
&nbsp;            }
&nbsp;
&nbsp;        })
<b class="nc">&nbsp;        mainBinding.searchMain.setOnQueryTextFocusChangeListener { _, hasFocus -&gt;</b>
<b class="nc">&nbsp;            if (hasFocus) {</b>
<b class="nc">&nbsp;                mainBinding.listSearchSuggestion.visibility = View.VISIBLE</b>
<b class="nc">&nbsp;                mainBinding.btnSettings.visibility = View.GONE</b>
<b class="nc">&nbsp;                bottomSheetBehavior.state = BottomSheetBehavior.STATE_COLLAPSED</b>
<b class="nc">&nbsp;                bottomSheetBinding.root.visibility = View.GONE</b>
&nbsp;            } else {
<b class="nc">&nbsp;                mainBinding.listSearchSuggestion.visibility = View.GONE</b>
<b class="nc">&nbsp;                mainBinding.btnSettings.visibility = View.VISIBLE</b>
<b class="nc">&nbsp;                bottomSheetBinding.root.visibility = View.VISIBLE</b>
<b class="nc">&nbsp;                bottomSheetBehavior.state = BottomSheetBehavior.STATE_HALF_EXPANDED</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        mainBinding.listSearchSuggestion.visibility = View.GONE</b>
&nbsp;
<b class="nc">&nbsp;        mainBinding.listSearchSuggestion.setOnItemClickListener{ _, _, position, _ -&gt;</b>
<b class="nc">&nbsp;            val selectedItem = searchAdapter.getItem(position) as String</b>
<b class="nc">&nbsp;            mainBinding.searchMain.setQuery(selectedItem, false)</b>
<b class="nc">&nbsp;            viewModel.setLocation(selectedItem)</b>
<b class="nc">&nbsp;            mainBinding.searchMain.clearFocus()</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        bottomSheetBinding.rvDisasterList.addOnItemTouchListener(object: RecyclerView.OnItemTouchListener {</b>
<b class="nc">&nbsp;            private val gestureDetector = GestureDetector(bottomSheetBinding.rvDisasterList.context, object: GestureDetector.SimpleOnGestureListener() {</b>
&nbsp;                override fun onSingleTapUp(e: MotionEvent): Boolean {
<b class="nc">&nbsp;                    return true</b>
&nbsp;                }
&nbsp;            })
&nbsp;
&nbsp;            override fun onInterceptTouchEvent(rv: RecyclerView, e: MotionEvent): Boolean {
<b class="nc">&nbsp;                val childView = rv.findChildViewUnder(e.x, e.y)</b>
<b class="nc">&nbsp;                if (childView != null &amp;&amp; gestureDetector.onTouchEvent(e)) {</b>
<b class="nc">&nbsp;                    childView.callOnClick()</b>
<b class="nc">&nbsp;                    bottomSheetBehavior.state = BottomSheetBehavior.STATE_COLLAPSED</b>
<b class="nc">&nbsp;                    return true</b>
&nbsp;                }
<b class="nc">&nbsp;                return false</b>
&nbsp;            }
&nbsp;
&nbsp;            override fun onTouchEvent(rv: RecyclerView, e: MotionEvent) {
<b class="nc">&nbsp;                if (gestureDetector.onTouchEvent(e)) {</b>
<b class="nc">&nbsp;                    bottomSheetBinding.btnBack.visibility = View.INVISIBLE</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            override fun onRequestDisallowInterceptTouchEvent(disallowIntercept: Boolean) {  }</b>
&nbsp;
&nbsp;        })
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    @SuppressLint(&quot;UseCompatLoadingForDrawables&quot;)
&nbsp;    private fun onCustomRadioButtonClick(view: View): Boolean {
<b class="nc">&nbsp;        val isAlreadySelected = view.isSelected</b>
&nbsp;
<b class="nc">&nbsp;        if (!isAlreadySelected) {</b>
<b class="nc">&nbsp;            view.isSelected = true</b>
<b class="nc">&nbsp;            view.background = getDrawable(R.drawable.round_fill_green)</b>
&nbsp;        } else {
<b class="nc">&nbsp;            view.isSelected = false</b>
<b class="nc">&nbsp;            view.background = getDrawable(R.drawable.round_fill)</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return view.isSelected</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    private fun setMapPoints(list: ArrayList&lt;DisasterItems&gt;) {
<b class="nc">&nbsp;        var lastLoc = LatLng(-0.7893, 113.9213)</b>
<b class="nc">&nbsp;        for (item in list) {</b>
<b class="nc">&nbsp;            val latitude = String.format(&quot;%.2f&quot;, item.coordinates?.get(0)?:0.0).toDouble()</b>
<b class="nc">&nbsp;            val longitude = String.format(&quot;%.2f&quot;, item.coordinates?.get(1)?:0.0).toDouble()</b>
<b class="nc">&nbsp;            val location = LatLng(latitude, longitude)</b>
<b class="nc">&nbsp;            val vectorDrawable = VectorDrawableCompat.create(</b>
<b class="nc">&nbsp;                resources,</b>
<b class="nc">&nbsp;                disasterUtils.getMarkerIcon(item.disasterProperties?.disasterType),</b>
<b class="nc">&nbsp;                null</b>
&nbsp;            )
&nbsp;
<b class="nc">&nbsp;            val markerTitle = disasterUtils.getDisasterType(item.disasterProperties?.disasterType)</b>
<b class="nc">&nbsp;            val markerSubtitle = disasterUtils.getRegionString(item.disasterProperties?.tags?.instanceRegionCode ?:&quot;&quot;)</b>
&nbsp;
&nbsp;
&nbsp;
&nbsp;
<b class="nc">&nbsp;            val bitmap = BitmapUtils().vectorToBitmap(vectorDrawable)</b>
&nbsp;
<b class="nc">&nbsp;            mapFragment.getMapAsync {googleMap -&gt;</b>
<b class="nc">&nbsp;                googleMap.addMarker(</b>
<b class="nc">&nbsp;                    MarkerOptions()</b>
<b class="nc">&nbsp;                        .position(location)</b>
<b class="nc">&nbsp;                        .title(markerTitle)</b>
<b class="nc">&nbsp;                        .snippet(markerSubtitle)</b>
<b class="nc">&nbsp;                        .icon(BitmapDescriptorFactory.fromBitmap(bitmap))</b>
&nbsp;                )
&nbsp;            }
&nbsp;//            lastLoc = location
&nbsp;        }
<b class="nc">&nbsp;        mapFragment.getMapAsync {</b>
<b class="nc">&nbsp;            it.animateCamera(CameraUpdateFactory.newLatLngZoom(lastLoc, 5f))</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    override fun onItemClicked(latitude: Double, longitude: Double) {
<b class="nc">&nbsp;        mapFragment.getMapAsync {</b>
<b class="nc">&nbsp;            it.animateCamera(CameraUpdateFactory.zoomOut())</b>
<b class="nc">&nbsp;            it.animateCamera(</b>
<b class="nc">&nbsp;                CameraUpdateFactory.newLatLngZoom(</b>
<b class="nc">&nbsp;                    LatLng(latitude, longitude), 10f)</b>
&nbsp;            )
<b class="nc">&nbsp;            bottomSheetBehavior.state = BottomSheetBehavior.STATE_COLLAPSED</b>
&nbsp;
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-08-15 00:39</div>
</div>
</body>
</html>
